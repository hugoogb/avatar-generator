---
/**
 * Interactive Playground Component for Avatar Generator
 * Shows all 6 avatar styles with live preview
 */
---

<div class="playground">
  <div class="playground-header">
    <h3>Avatar Styles Preview</h3>
    <p>Enter a seed value to see how each style generates unique avatars</p>
  </div>

  <div class="playground-controls">
    <label for="seed-input">Seed:</label>
    <input
      type="text"
      id="seed-input"
      value="John Doe"
      placeholder="Enter any string..."
    />
    <label for="size-input">Size:</label>
    <input
      type="range"
      id="size-input"
      min="32"
      max="128"
      value="64"
    />
    <span id="size-value">64px</span>
  </div>

  <div class="style-gallery">
    <div class="style-card">
      <h4>Initials</h4>
      <div class="avatar-preview" id="preview-initials"></div>
      <code>@avatar-generator/style-initials</code>
    </div>

    <div class="style-card">
      <h4>Identicon</h4>
      <div class="avatar-preview" id="preview-geometric"></div>
      <code>@avatar-generator/style-geometric</code>
    </div>

    <div class="style-card">
      <h4>Pixel Faces</h4>
      <div class="avatar-preview" id="preview-pixels"></div>
      <code>@avatar-generator/style-pixels</code>
    </div>

    <div class="style-card">
      <h4>Rings</h4>
      <div class="avatar-preview" id="preview-rings"></div>
      <code>@avatar-generator/style-rings</code>
    </div>

    <div class="style-card">
      <h4>Faces</h4>
      <div class="avatar-preview" id="preview-faces"></div>
      <code>@avatar-generator/style-faces</code>
    </div>

    <div class="style-card">
      <h4>Illustrated</h4>
      <div class="avatar-preview" id="preview-illustrated"></div>
      <code>@avatar-generator/style-illustrated</code>
    </div>
  </div>

  <div class="playground-options">
    <label>
      <input type="checkbox" id="square-toggle" />
      Square shape
    </label>
    <label>
      <input type="checkbox" id="transparent-toggle" />
      Transparent background
    </label>
  </div>
</div>

<style>
  .playground {
    background: var(--sl-color-gray-6);
    border-radius: 0.5rem;
    padding: 1.5rem;
    margin: 1.5rem 0;
  }

  .playground-header {
    margin-bottom: 1rem;
  }

  .playground-header h3 {
    margin: 0 0 0.5rem 0;
  }

  .playground-header p {
    margin: 0;
    color: var(--sl-color-gray-2);
    font-size: 0.9rem;
  }

  .playground-controls {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }

  .playground-controls label {
    font-weight: 500;
    font-size: 0.9rem;
  }

  .playground-controls input[type="text"] {
    padding: 0.5rem 0.75rem;
    border-radius: 0.25rem;
    border: 1px solid var(--sl-color-gray-4);
    background: var(--sl-color-gray-7);
    color: var(--sl-color-text);
    font-size: 0.9rem;
    min-width: 200px;
  }

  .playground-controls input[type="range"] {
    width: 100px;
  }

  #size-value {
    font-size: 0.85rem;
    color: var(--sl-color-gray-2);
    min-width: 40px;
  }

  .style-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .style-card {
    background: var(--sl-color-gray-7);
    border-radius: 0.5rem;
    padding: 1rem;
    text-align: center;
  }

  .style-card h4 {
    margin: 0 0 0.75rem 0;
    font-size: 0.95rem;
  }

  .avatar-preview {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 80px;
    margin-bottom: 0.75rem;
  }

  .avatar-preview img {
    border-radius: 50%;
    transition: transform 0.2s ease;
  }

  .avatar-preview img:hover {
    transform: scale(1.1);
  }

  .style-card code {
    font-size: 0.7rem;
    color: var(--sl-color-gray-2);
    word-break: break-all;
  }

  .playground-options {
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
  }

  .playground-options label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    cursor: pointer;
  }
</style>

<script>
  // Simple avatar generation for the playground
  // This is a simplified version for documentation purposes

  const DEFAULT_COLORS = [
    '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7',
    '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9'
  ];

  const SKIN_TONES = ['#FFDBB4', '#EAC086', '#C68B59', '#A0674B', '#8D5524', '#613915'];

  function hashSeed(seed: string): number {
    let h1 = 0xdeadbeef;
    let h2 = 0x41c6ce57;
    for (let i = 0; i < seed.length; i++) {
      const ch = seed.charCodeAt(i);
      h1 = Math.imul(h1 ^ ch, 2654435761);
      h2 = Math.imul(h2 ^ ch, 1597334677);
    }
    h1 = Math.imul(h1 ^ (h1 >>> 16), 2246822507);
    h1 ^= Math.imul(h2 ^ (h2 >>> 13), 3266489909);
    return (h1 >>> 0);
  }

  function createRandom(seed: string) {
    let s = hashSeed(seed);
    const next = () => {
      let t = s += 0x6d2b79f5;
      t = Math.imul(t ^ (t >>> 15), t | 1);
      t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
      return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
    };
    return {
      next,
      pick: <T,>(arr: T[]): T => arr[Math.floor(next() * arr.length)],
      bool: (p = 0.5) => next() < p,
    };
  }

  type GenFn = (seed: string, size: number, square: boolean, transparent: boolean) => string;

  function svgWrap(size: number, square: boolean, transparent: boolean, bg: string, content: string): string {
    const r = size / 2;
    const clip = square
      ? `<clipPath id="c"><rect x="0" y="0" width="${size}" height="${size}"/></clipPath>`
      : `<clipPath id="c"><circle cx="${r}" cy="${r}" r="${r}"/></clipPath>`;
    const bgRect = transparent ? '' : `<rect x="0" y="0" width="${size}" height="${size}" fill="${bg}"/>`;
    return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${size} ${size}" width="${size}" height="${size}"><defs>${clip}</defs><g clip-path="url(#c)">${bgRect}${content}</g></svg>`;
  }

  function getInitials(name: string): string {
    if (!name.trim()) return '?';
    return name.split(' ').filter(Boolean).slice(0, 2).map(p => p[0].toUpperCase()).join('');
  }

  const generateInitials: GenFn = (seed, size, square, transparent) => {
    const rng = createRandom(seed);
    const bg = rng.pick(DEFAULT_COLORS);
    const initials = getInitials(seed);
    const fontSize = size * (initials.length === 1 ? 0.5 : 0.4);
    const r = size / 2;
    const content = `<text x="${r}" y="${r}" font-family="sans-serif" font-size="${fontSize}" font-weight="600" fill="#fff" text-anchor="middle" dominant-baseline="central">${initials}</text>`;
    return svgWrap(size, square, transparent, bg, content);
  };

  const generateGeometric: GenFn = (seed, size, square, transparent) => {
    const rng = createRandom(seed);
    const bg = rng.pick(DEFAULT_COLORS);
    const fg = rng.pick(DEFAULT_COLORS);
    const gridSize = 5;
    const padding = 1;
    const cellSize = size / (gridSize + padding * 2);
    const offset = padding * cellSize;
    const halfCols = Math.ceil(gridSize / 2);

    const grid: boolean[][] = [];
    let filled = 0;
    for (let row = 0; row < gridSize; row++) {
      grid[row] = [];
      for (let col = 0; col < halfCols; col++) {
        const f = rng.bool(0.5);
        grid[row][col] = f;
        if (f) filled += (gridSize % 2 === 1 && col === halfCols - 1) ? 1 : 2;
      }
    }
    if (filled < 3) {
      for (let row = 0; row < gridSize && filled < 3; row++) {
        if (!grid[row][halfCols - 1]) { grid[row][halfCols - 1] = true; filled++; }
      }
    }

    let content = '';
    for (let row = 0; row < gridSize; row++) {
      for (let col = 0; col < gridSize; col++) {
        const src = col < halfCols ? col : gridSize - 1 - col;
        if (grid[row][src]) {
          content += `<rect x="${offset + col * cellSize}" y="${offset + row * cellSize}" width="${cellSize}" height="${cellSize}" fill="${fg}"/>`;
        }
      }
    }
    return svgWrap(size, square, transparent, bg, content);
  };

  const generatePixels: GenFn = (seed, size, square, transparent) => {
    const rng = createRandom(seed);
    const bg = rng.pick(DEFAULT_COLORS);
    const skinColor = rng.pick(SKIN_TONES);
    const hairColor = rng.pick(DEFAULT_COLORS);
    const feat = '#2C1810';
    const cellSize = size / 8;
    const pixels = new Map<string, string>();

    // Head
    for (let row = 1; row <= 6; row++)
      for (let col = 1; col <= 6; col++) {
        if ((row === 1 || row === 6) && (col === 1 || col === 6)) continue;
        pixels.set(`${row},${col}`, skinColor);
      }

    // Hair (random simple style)
    const hairPixels: [number, number][] = rng.bool()
      ? [[0,1],[0,2],[0,3],[0,4],[0,5],[0,6],[1,1],[1,6]]
      : [[0,1],[0,3],[0,5],[1,1],[1,2],[1,3],[1,4],[1,5],[1,6]];
    for (const [r, c] of hairPixels) pixels.set(`${r},${c}`, hairColor);

    // Eyes
    pixels.set('3,2', feat); pixels.set('3,5', feat);

    // Mouth
    if (rng.bool()) { pixels.set('5,2', feat); pixels.set('5,5', feat); pixels.set('6,3', feat); pixels.set('6,4', feat); }
    else { pixels.set('5,3', feat); pixels.set('5,4', feat); }

    let content = '';
    for (const [key, color] of pixels) {
      const [r, c] = key.split(',').map(Number);
      content += `<rect x="${c * cellSize}" y="${r * cellSize}" width="${cellSize}" height="${cellSize}" fill="${color}"/>`;
    }
    return svgWrap(size, square, transparent, bg, content);
  };

  const generateRings: GenFn = (seed, size, square, transparent) => {
    const rng = createRandom(seed);
    const bg = rng.pick(DEFAULT_COLORS);
    const ringCount = 4;
    const ringGap = 2;
    const cx = size / 2;
    const cy = size / 2;
    const maxR = size / 2;
    const totalGap = ringGap * (ringCount - 1);
    const ringWidth = (maxR - totalGap) / ringCount;

    let content = '';
    for (let i = ringCount - 1; i >= 0; i--) {
      const color = rng.pick(DEFAULT_COLORS);
      const outerR = maxR - i * (ringWidth + ringGap);
      const innerR = outerR - ringWidth;
      if (innerR > 0) {
        content += `<path d="M ${cx} ${cy - outerR} A ${outerR} ${outerR} 0 1 1 ${cx} ${cy + outerR} A ${outerR} ${outerR} 0 1 1 ${cx} ${cy - outerR} M ${cx} ${cy - innerR} A ${innerR} ${innerR} 0 1 0 ${cx} ${cy + innerR} A ${innerR} ${innerR} 0 1 0 ${cx} ${cy - innerR}" fill="${color}" fill-rule="evenodd"/>`;
      } else {
        content += `<circle cx="${cx}" cy="${cy}" r="${outerR}" fill="${color}"/>`;
      }
    }
    return svgWrap(size, square, transparent, bg, content);
  };

  const generateFaces: GenFn = (seed, size, square, transparent) => {
    const rng = createRandom(seed);
    const bg = rng.pick(DEFAULT_COLORS);
    const skinColor = rng.pick(SKIN_TONES);
    const hairColor = rng.pick(DEFAULT_COLORS);
    const feat = '#2C1810';
    const cx = size / 2;
    const cy = size / 2;
    const headW = size * 0.55;
    const headH = size * 0.65;
    const eyeY = cy - headH * 0.08;
    const eyeSpacing = headW * 0.22;
    const mouthY = cy + headH * 0.18;
    const top = cy - headH / 2;

    let content = '';
    // Hair behind
    if (rng.bool(0.7)) {
      content += `<ellipse cx="${cx}" cy="${top}" rx="${headW / 2 + 4}" ry="${headH * 0.22}" fill="${hairColor}"/>`;
    }
    // Head
    content += `<ellipse cx="${cx}" cy="${cy}" rx="${headW / 2}" ry="${headH / 2}" fill="${skinColor}"/>`;
    // Eyes
    const lx = cx - eyeSpacing;
    const rx = cx + eyeSpacing;
    content += `<circle cx="${lx}" cy="${eyeY}" r="2" fill="${feat}"/><circle cx="${rx}" cy="${eyeY}" r="2" fill="${feat}"/>`;
    // Mouth
    content += `<path d="M ${cx - 5} ${mouthY} Q ${cx} ${mouthY + 6} ${cx + 5} ${mouthY}" fill="none" stroke="${feat}" stroke-width="1.5" stroke-linecap="round"/>`;

    return svgWrap(size, square, transparent, bg, content);
  };

  const generateIllustrated: GenFn = (seed, size, square, transparent) => {
    const rng = createRandom(seed);
    const bg = rng.pick(DEFAULT_COLORS);
    const skinColor = rng.pick(SKIN_TONES);
    const hairColor = rng.pick(DEFAULT_COLORS);
    const eyeColor = rng.pick(['#634E34', '#2E536F', '#3D6B45']);
    const feat = '#2C1810';
    const cx = size * 0.5;
    const cy = size * 0.48;
    const headW = size * 0.6;
    const headH = size * 0.7;
    const eyeY = cy - headH * 0.04;
    const eyeSpacing = headW * 0.2;
    const mouthY = cy + headH * 0.22;
    const top = cy - headH / 2;
    const left = cx - headW / 2;
    const right = cx + headW / 2;

    let content = '';
    // Hair behind
    content += `<path d="M ${left - 3} ${cy - 2} Q ${left - 4} ${top - 8} ${cx} ${top - 10} Q ${right + 4} ${top - 8} ${right + 3} ${cy - 2}" fill="${hairColor}"/>`;
    // Ears
    const earR = size * 0.055;
    content += `<ellipse cx="${cx - headW / 2 - earR * 0.5}" cy="${eyeY + 2}" rx="${earR}" ry="${earR * 1.2}" fill="${skinColor}"/>`;
    content += `<ellipse cx="${cx + headW / 2 + earR * 0.5}" cy="${eyeY + 2}" rx="${earR}" ry="${earR * 1.2}" fill="${skinColor}"/>`;
    // Head
    content += `<ellipse cx="${cx}" cy="${cy}" rx="${headW / 2}" ry="${headH / 2}" fill="${skinColor}"/>`;
    // Eyebrows
    const browY = cy - headH * 0.12;
    const lx = cx - eyeSpacing;
    const rx = cx + eyeSpacing;
    content += `<path d="M ${lx - 4} ${browY + 1} Q ${lx} ${browY - 2} ${lx + 4} ${browY + 1}" fill="none" stroke="${feat}" stroke-width="1.5" stroke-linecap="round"/>`;
    content += `<path d="M ${rx - 4} ${browY + 1} Q ${rx} ${browY - 2} ${rx + 4} ${browY + 1}" fill="none" stroke="${feat}" stroke-width="1.5" stroke-linecap="round"/>`;
    // Eyes
    content += `<circle cx="${lx}" cy="${eyeY}" r="3.5" fill="white"/><circle cx="${lx}" cy="${eyeY}" r="2" fill="${eyeColor}"/>`;
    content += `<circle cx="${rx}" cy="${eyeY}" r="3.5" fill="white"/><circle cx="${rx}" cy="${eyeY}" r="2" fill="${eyeColor}"/>`;
    // Nose
    const noseY = cy + headH * 0.08;
    content += `<circle cx="${cx}" cy="${noseY}" r="1.5" fill="${feat}"/>`;
    // Mouth
    content += `<path d="M ${cx - 6} ${mouthY} Q ${cx} ${mouthY + 7} ${cx + 6} ${mouthY}" fill="none" stroke="${feat}" stroke-width="1.5" stroke-linecap="round"/>`;

    return svgWrap(size, square, transparent, bg, content);
  };

  function updatePreviews() {
    const seedInput = document.getElementById('seed-input') as HTMLInputElement;
    const sizeInput = document.getElementById('size-input') as HTMLInputElement;
    const squareToggle = document.getElementById('square-toggle') as HTMLInputElement;
    const transparentToggle = document.getElementById('transparent-toggle') as HTMLInputElement;
    const sizeValue = document.getElementById('size-value');

    const seed = seedInput?.value || 'John Doe';
    const size = parseInt(sizeInput?.value || '64');
    const square = squareToggle?.checked || false;
    const transparent = transparentToggle?.checked || false;

    if (sizeValue) sizeValue.textContent = `${size}px`;

    const previews: Record<string, GenFn> = {
      'preview-initials': generateInitials,
      'preview-geometric': generateGeometric,
      'preview-pixels': generatePixels,
      'preview-rings': generateRings,
      'preview-faces': generateFaces,
      'preview-illustrated': generateIllustrated,
    };

    for (const [id, generator] of Object.entries(previews)) {
      const el = document.getElementById(id);
      if (el) {
        const svg = generator(seed, size, square, transparent);
        const img = document.createElement('img');
        img.src = `data:image/svg+xml;base64,${btoa(svg)}`;
        img.alt = id.replace('preview-', '') + ' avatar';
        img.style.borderRadius = square ? '0' : '50%';
        el.replaceChildren(img);
      }
    }
  }

  document.getElementById('seed-input')?.addEventListener('input', updatePreviews);
  document.getElementById('size-input')?.addEventListener('input', updatePreviews);
  document.getElementById('square-toggle')?.addEventListener('change', updatePreviews);
  document.getElementById('transparent-toggle')?.addEventListener('change', updatePreviews);

  // Initial render
  updatePreviews();
</script>
