---
/**
 * Interactive Playground Component for Avatar Generator
 * Shows all 4 avatar styles with live preview
 */
---

<div class="playground">
  <div class="playground-header">
    <h3>Avatar Styles Preview</h3>
    <p>Enter a seed value to see how each style generates unique avatars</p>
  </div>

  <div class="playground-controls">
    <label for="seed-input">Seed:</label>
    <input
      type="text"
      id="seed-input"
      value="John Doe"
      placeholder="Enter any string..."
    />
    <label for="size-input">Size:</label>
    <input
      type="range"
      id="size-input"
      min="32"
      max="128"
      value="64"
    />
    <span id="size-value">64px</span>
  </div>

  <div class="style-gallery">
    <div class="style-card">
      <h4>Initials</h4>
      <div class="avatar-preview" id="preview-initials"></div>
      <code>@avatar-generator/style-initials</code>
    </div>

    <div class="style-card">
      <h4>Geometric</h4>
      <div class="avatar-preview" id="preview-geometric"></div>
      <code>@avatar-generator/style-geometric</code>
    </div>

    <div class="style-card">
      <h4>Pixels</h4>
      <div class="avatar-preview" id="preview-pixels"></div>
      <code>@avatar-generator/style-pixels</code>
    </div>

    <div class="style-card">
      <h4>Rings</h4>
      <div class="avatar-preview" id="preview-rings"></div>
      <code>@avatar-generator/style-rings</code>
    </div>
  </div>

  <div class="playground-options">
    <label>
      <input type="checkbox" id="square-toggle" />
      Square shape
    </label>
    <label>
      <input type="checkbox" id="transparent-toggle" />
      Transparent background
    </label>
  </div>
</div>

<style>
  .playground {
    background: var(--sl-color-gray-6);
    border-radius: 0.5rem;
    padding: 1.5rem;
    margin: 1.5rem 0;
  }

  .playground-header {
    margin-bottom: 1rem;
  }

  .playground-header h3 {
    margin: 0 0 0.5rem 0;
  }

  .playground-header p {
    margin: 0;
    color: var(--sl-color-gray-2);
    font-size: 0.9rem;
  }

  .playground-controls {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }

  .playground-controls label {
    font-weight: 500;
    font-size: 0.9rem;
  }

  .playground-controls input[type="text"] {
    padding: 0.5rem 0.75rem;
    border-radius: 0.25rem;
    border: 1px solid var(--sl-color-gray-4);
    background: var(--sl-color-gray-7);
    color: var(--sl-color-text);
    font-size: 0.9rem;
    min-width: 200px;
  }

  .playground-controls input[type="range"] {
    width: 100px;
  }

  #size-value {
    font-size: 0.85rem;
    color: var(--sl-color-gray-2);
    min-width: 40px;
  }

  .style-gallery {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1rem;
    margin-bottom: 1rem;
  }

  .style-card {
    background: var(--sl-color-gray-7);
    border-radius: 0.5rem;
    padding: 1rem;
    text-align: center;
  }

  .style-card h4 {
    margin: 0 0 0.75rem 0;
    font-size: 0.95rem;
  }

  .avatar-preview {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 80px;
    margin-bottom: 0.75rem;
  }

  .avatar-preview img {
    border-radius: 50%;
    transition: transform 0.2s ease;
  }

  .avatar-preview img:hover {
    transform: scale(1.1);
  }

  .style-card code {
    font-size: 0.7rem;
    color: var(--sl-color-gray-2);
    word-break: break-all;
  }

  .playground-options {
    display: flex;
    gap: 1.5rem;
    flex-wrap: wrap;
  }

  .playground-options label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    cursor: pointer;
  }
</style>

<script>
  // Simple avatar generation for the playground
  // This is a simplified version for documentation purposes

  const DEFAULT_COLORS = [
    '#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7',
    '#DDA0DD', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E9'
  ];

  function hashSeed(seed: string): number {
    let h1 = 0xdeadbeef;
    let h2 = 0x41c6ce57;
    for (let i = 0; i < seed.length; i++) {
      const ch = seed.charCodeAt(i);
      h1 = Math.imul(h1 ^ ch, 2654435761);
      h2 = Math.imul(h2 ^ ch, 1597334677);
    }
    h1 = Math.imul(h1 ^ (h1 >>> 16), 2246822507);
    h1 ^= Math.imul(h2 ^ (h2 >>> 13), 3266489909);
    return (h1 >>> 0);
  }

  function createRandom(seed: string) {
    let s = hashSeed(seed);
    return {
      next: () => {
        let t = s += 0x6d2b79f5;
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      },
      pick: <T,>(arr: T[]): T => {
        let t = s += 0x6d2b79f5;
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
        const r = ((t ^ (t >>> 14)) >>> 0) / 4294967296;
        return arr[Math.floor(r * arr.length)];
      }
    };
  }

  function getInitials(name: string): string {
    if (!name.trim()) return '?';
    return name.split(' ').filter(Boolean).slice(0, 2).map(p => p[0].toUpperCase()).join('');
  }

  function generateInitials(seed: string, size: number, square: boolean, transparent: boolean): string {
    const rng = createRandom(seed);
    const bg = rng.pick(DEFAULT_COLORS);
    const initials = getInitials(seed);
    const fontSize = size * (initials.length === 1 ? 0.5 : 0.4);
    const r = size / 2;
    const clip = square
      ? `<clipPath id="c"><rect x="0" y="0" width="${size}" height="${size}"/></clipPath>`
      : `<clipPath id="c"><circle cx="${r}" cy="${r}" r="${r}"/></clipPath>`;
    const bgRect = transparent ? '' : `<rect x="0" y="0" width="${size}" height="${size}" fill="${bg}"/>`;

    return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${size} ${size}" width="${size}" height="${size}">
      <defs>${clip}</defs>
      <g clip-path="url(#c)">${bgRect}
        <text x="${r}" y="${r}" font-family="sans-serif" font-size="${fontSize}" font-weight="600" fill="#fff" text-anchor="middle" dominant-baseline="central">${initials}</text>
      </g>
    </svg>`;
  }

  function generateGeometric(seed: string, size: number, square: boolean, transparent: boolean): string {
    const rng = createRandom(seed);
    const bg = rng.pick(DEFAULT_COLORS);
    const gridSize = 4;
    const cellSize = size / gridSize;
    const shapes = ['circle', 'square', 'triangle', 'diamond'];
    const r = size / 2;
    const clip = square
      ? `<clipPath id="c"><rect x="0" y="0" width="${size}" height="${size}"/></clipPath>`
      : `<clipPath id="c"><circle cx="${r}" cy="${r}" r="${r}"/></clipPath>`;
    const bgRect = transparent ? '' : `<rect x="0" y="0" width="${size}" height="${size}" fill="${bg}"/>`;

    let content = '';
    for (let row = 0; row < gridSize; row++) {
      for (let col = 0; col < gridSize; col++) {
        if (rng.next() < 0.7) {
          const shape = rng.pick(shapes);
          const color = rng.pick(DEFAULT_COLORS);
          const x = col * cellSize;
          const y = row * cellSize;
          const cx = x + cellSize / 2;
          const cy = y + cellSize / 2;
          const sr = cellSize * 0.4;

          if (shape === 'circle') {
            content += `<circle cx="${cx}" cy="${cy}" r="${sr}" fill="${color}"/>`;
          } else if (shape === 'square') {
            const off = cellSize * 0.1;
            const sz = cellSize * 0.8;
            content += `<rect x="${x + off}" y="${y + off}" width="${sz}" height="${sz}" fill="${color}"/>`;
          } else if (shape === 'triangle') {
            content += `<polygon points="${cx},${cy - sr} ${cx - sr},${cy + sr * 0.7} ${cx + sr},${cy + sr * 0.7}" fill="${color}"/>`;
          } else {
            content += `<polygon points="${cx},${cy - sr} ${cx + sr},${cy} ${cx},${cy + sr} ${cx - sr},${cy}" fill="${color}"/>`;
          }
        }
      }
    }

    return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${size} ${size}" width="${size}" height="${size}">
      <defs>${clip}</defs>
      <g clip-path="url(#c)">${bgRect}${content}</g>
    </svg>`;
  }

  function generatePixels(seed: string, size: number, square: boolean, transparent: boolean): string {
    const rng = createRandom(seed);
    const bg = rng.pick(DEFAULT_COLORS);
    const pixelSize = 8;
    const cellSize = size / pixelSize;
    const colsToGen = Math.ceil(pixelSize / 2);
    const r = size / 2;
    const clip = square
      ? `<clipPath id="c"><rect x="0" y="0" width="${size}" height="${size}"/></clipPath>`
      : `<clipPath id="c"><circle cx="${r}" cy="${r}" r="${r}"/></clipPath>`;
    const bgRect = transparent ? '' : `<rect x="0" y="0" width="${size}" height="${size}" fill="${bg}"/>`;

    const grid: (string | null)[][] = [];
    for (let row = 0; row < pixelSize; row++) {
      grid[row] = [];
      for (let col = 0; col < colsToGen; col++) {
        const dist = Math.abs(col - colsToGen / 2) / colsToGen;
        const prob = 0.5 + (1 - dist) * 0.3;
        grid[row][col] = rng.next() < prob ? rng.pick(DEFAULT_COLORS) : null;
      }
    }

    let content = '';
    for (let row = 0; row < pixelSize; row++) {
      for (let col = 0; col < pixelSize; col++) {
        const srcCol = col >= colsToGen ? pixelSize - 1 - col : col;
        const color = grid[row][srcCol];
        if (color) {
          content += `<rect x="${col * cellSize}" y="${row * cellSize}" width="${cellSize}" height="${cellSize}" fill="${color}"/>`;
        }
      }
    }

    return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${size} ${size}" width="${size}" height="${size}">
      <defs>${clip}</defs>
      <g clip-path="url(#c)">${bgRect}${content}</g>
    </svg>`;
  }

  function generateRings(seed: string, size: number, square: boolean, transparent: boolean): string {
    const rng = createRandom(seed);
    const bg = rng.pick(DEFAULT_COLORS);
    const ringCount = 4;
    const ringGap = 2;
    const cx = size / 2;
    const cy = size / 2;
    const maxR = size / 2;
    const totalGap = ringGap * (ringCount - 1);
    const ringWidth = (maxR - totalGap) / ringCount;
    const r = size / 2;
    const clip = square
      ? `<clipPath id="c"><rect x="0" y="0" width="${size}" height="${size}"/></clipPath>`
      : `<clipPath id="c"><circle cx="${r}" cy="${r}" r="${r}"/></clipPath>`;
    const bgRect = transparent ? '' : `<rect x="0" y="0" width="${size}" height="${size}" fill="${bg}"/>`;

    let content = '';
    for (let i = ringCount - 1; i >= 0; i--) {
      const color = rng.pick(DEFAULT_COLORS);
      const outerR = maxR - i * (ringWidth + ringGap);
      const innerR = outerR - ringWidth;

      if (innerR > 0) {
        content += `<path d="M ${cx} ${cy - outerR} A ${outerR} ${outerR} 0 1 1 ${cx} ${cy + outerR} A ${outerR} ${outerR} 0 1 1 ${cx} ${cy - outerR} M ${cx} ${cy - innerR} A ${innerR} ${innerR} 0 1 0 ${cx} ${cy + innerR} A ${innerR} ${innerR} 0 1 0 ${cx} ${cy - innerR}" fill="${color}" fill-rule="evenodd"/>`;
      } else {
        content += `<circle cx="${cx}" cy="${cy}" r="${outerR}" fill="${color}"/>`;
      }
    }

    return `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 ${size} ${size}" width="${size}" height="${size}">
      <defs>${clip}</defs>
      <g clip-path="url(#c)">${bgRect}${content}</g>
    </svg>`;
  }

  function updatePreviews() {
    const seedInput = document.getElementById('seed-input') as HTMLInputElement;
    const sizeInput = document.getElementById('size-input') as HTMLInputElement;
    const squareToggle = document.getElementById('square-toggle') as HTMLInputElement;
    const transparentToggle = document.getElementById('transparent-toggle') as HTMLInputElement;
    const sizeValue = document.getElementById('size-value');

    const seed = seedInput?.value || 'John Doe';
    const size = parseInt(sizeInput?.value || '64');
    const square = squareToggle?.checked || false;
    const transparent = transparentToggle?.checked || false;

    if (sizeValue) sizeValue.textContent = `${size}px`;

    const previews = {
      'preview-initials': generateInitials,
      'preview-geometric': generateGeometric,
      'preview-pixels': generatePixels,
      'preview-rings': generateRings,
    };

    for (const [id, generator] of Object.entries(previews)) {
      const el = document.getElementById(id);
      if (el) {
        const svg = generator(seed, size, square, transparent);
        const img = document.createElement('img');
        img.src = `data:image/svg+xml;base64,${btoa(svg)}`;
        img.alt = id.replace('preview-', '') + ' avatar';
        img.style.borderRadius = square ? '0' : '50%';
        el.replaceChildren(img);
      }
    }
  }

  document.getElementById('seed-input')?.addEventListener('input', updatePreviews);
  document.getElementById('size-input')?.addEventListener('input', updatePreviews);
  document.getElementById('square-toggle')?.addEventListener('change', updatePreviews);
  document.getElementById('transparent-toggle')?.addEventListener('change', updatePreviews);

  // Initial render
  updatePreviews();
</script>
